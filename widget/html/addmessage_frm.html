<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>添加提醒</title>
    <link rel="stylesheet" type="text/css" href="../css/aui.css" />
    <link rel="stylesheet" type="text/css" href="../css/iconfont/iconfont.css" />
    <style type="text/css">
        #classify {
            color: #ffffff !important;
        }
    </style>
</head>
<body style="background-color:#a786c8;">
    <section class="aui-content " style="background-color: #711173 !important">
        <div class="aui-grid aui-bg-info" style="background-color: #711173 !important">
            <div class="aui-row" id="classify">
                <div class="aui-col-xs-3" onclick="selectType(1);" id="type1">
                    <i class="aui-iconfont icon iconfont icon-yaopin"></i>
                    <div class="aui-grid-label">吃药</div>
                </div>
                <div class="aui-col-xs-3" onclick="selectType(2);" id="type2">
                    <i class="aui-iconfont icon iconfont icon-yiyuan"></i>
                    <div class="aui-grid-label">就医</div>
                </div>
                <div class="aui-col-xs-3" onclick="selectType(3);" id="type3">
                    <i class="aui-iconfont icon iconfont icon-zoulu-"></i>
                    <div class="aui-grid-label">锻炼</div>
                </div>
                <div class="aui-col-xs-3" onclick="selectType(4);" id="type4">
                    <i class="aui-iconfont icon iconfont icon-qita"></i>
                    <div class="aui-grid-label">其他</div>
                </div>
            </div>
        </div>
    </section>

    <section style="height:30px;">
        <div >
        </div>
    </section>

    <section class="aui-content">
        <div class="aui-card-list">
          <div class="aui-card-list-header aui-card-list-user" style="background-color: #711173 !important;">
            <div class="aui-card-list-user-name" onclick="openSound();">
                <div style="color:#ffffff;" id="audiotitle">请录音提醒内容</div>
                <i class="aui-iconfont aui-icon-right" style="color:#ffffff;"></i>
            </div>
              <!-- <div class="aui-card-list-user-name aui-list-item-input" onclick="openSound();">
                <input type="text" placeholder="请输入提醒标题" style="color:#ffffff">
                <div style="color:#ffffff;">请录音提醒内容</div>
              </div> -->
          </div>

          <section style="height:2px;">
              <div >
              </div>
          </section>

            <div class="aui-card-list-header aui-card-list-user" style="background-color: #711173 !important">
                <div class="aui-card-list-user-name" onclick="openTimeFrame();">
                    <div style="color:#ffffff;" id="alerttime">提醒时间</div>
                    <i class="aui-iconfont aui-icon-right" style="color:#ffffff;"></i>
                </div>
            </div>

            <section style="height:2px;">
                <div >
                </div>
            </section>

            <div class="aui-card-list-header aui-card-list-user" style="background-color: #711173 !important">
                <div class="aui-card-list-user-name" onclick="opentypeSelector();">
                    <div style="color:#ffffff;" id="alerttype">重复</div>
                    <i class="aui-iconfont aui-icon-right" style="color:#ffffff;"></i>
                </div>
            </div>

            <section style="height:2px;">
                <div >
                </div>
            </section>

            <div class="aui-card-list-header aui-card-list-user" style="background-color: #711173 !important">
                <div class="aui-card-list-user-name">
                    <div style="color:#ffffff;" id="ringtype">提醒方式（闹铃）</div>
                    <!-- <i class="aui-iconfont aui-icon-right" style="color:#ffffff;"></i> -->
                    <!-- <div class="aui-list-item-input">
                      <input type="checkbox" class="aui-switch" checked>
                  </div> -->
                </div>
            </div>

            <section style="height:2px;">
                <div >
                </div>
            </section>

            <!-- <div class="aui-card-list-header aui-card-list-user" style="background-color: #711173 !important">
                <div class="aui-card-list-user-name" onclick="openSound();">
                    <div style="color:#ffffff;">请录音提醒内容</div>
                    <i class="aui-iconfont aui-icon-right" style="color:#ffffff;"></i>
                </div>
            </div> -->
        </div>
    </section>

    <section class="aui-content-padded">
        <div class="aui-btn aui-btn-block aui-btn-info aui-btn-sm" tapmode onclick="alertsend();" style="background-color:#711173 !important;">保存</div>
    </section>

</body>
<script type="text/javascript" src="../script/api.js" ></script>
<script type="text/javascript">

    var sType = 0;
    var stime = '';
    var aType = '';//重复方式
    var rType = 0;
    var timestamp = '';
    var audiotitle = '';
    function getTop(e){
       var offset=e.offsetTop;
       if(e.offsetParent!=null){
         offset+=getTop(e.offsetParent);
       }
       return offset;
    }
    apiready = function () {
      api.addEventListener({
        name: 'soundtxt'
      },function(ret, err) {
        // alert("11111");
        // alert( JSON.stringify( ret ) );
        // alert(ret.value.shour+":"+ret.value.smin);

        audiotitle = ret.value.soundStr;
        var el = document.getElementById('audiotitle');
        // stime = ret.value.shour+":"+ret.value.smin;
        // alert( htmlStr );
        $api.html(el, audiotitle);
        timestamp = ret.value.timestamp;
        alert( timestamp +'--'+audiotitle);

        // closetimeSelector();
      });

      // var el = document.getElementById('alerttype');
      // var swTop = getTop(el);
      var el = $api.byId('ringtype');
      var swtop = $api.offset(el);
      // alert( swtop.t );

      var switchBtn = api.require('UISwitchButton');
      switchBtn.open({
          id:'ringButton',
          state:true,
          rect: {
            x: api.winWidth*0.72,
            // y: 50,
            y: swtop.t-3,
            w: 80,
            h: 30
          },
          styles:{
             bgCorner:15,
             active:'#ffffff' ,
             inActive:'#ffffff',
             thumb:{
                active:'#711173' ,
                inActive:'#711173' ,
                size:30,
                corner:15
             }
          },
          fixedOn: api.frameName,
          fixed: false
      }, function(ret) {
          // alert(JSON.stringify(ret));
          if(ret.state){
            var htmlStr = "提醒方式（闹铃）";
            var el = document.getElementById('ringtype');
            $api.html(el, htmlStr);
            rType = 0;
          }else{
            var htmlStr = "提醒方式（震动）";
            var el = document.getElementById('ringtype');
            $api.html(el, htmlStr);
            rType = 1;
          }
      });

    }


    function selectType (id) {
        sType = id;
        //api.alert({ msg: ret.msg });
        switch(id){
          case 1:
            document.getElementById("type1").style.background="#a33fad";
            document.getElementById("type2").style.background="#711173";
            document.getElementById("type3").style.background="#711173";
            document.getElementById("type4").style.background="#711173";
            break;
          case 2:
          document.getElementById("type2").style.background="#a33fad";
          document.getElementById("type1").style.background="#711173";
          document.getElementById("type3").style.background="#711173";
          document.getElementById("type4").style.background="#711173";
            break;
          case 3:
          document.getElementById("type3").style.background="#a33fad";
          document.getElementById("type2").style.background="#711173";
          document.getElementById("type1").style.background="#711173";
          document.getElementById("type4").style.background="#711173";
            break;
          case 4:
          document.getElementById("type4").style.background="#a33fad";
          document.getElementById("type2").style.background="#711173";
          document.getElementById("type3").style.background="#711173";
          document.getElementById("type1").style.background="#711173";
            break;
        }
    }


    function opentypeSelector () {
      var UIMultiSelector = api.require('UIMultiSelector');
      UIMultiSelector.open({
        rect: {
         h: 244
         },
         text: {
             title: '请选择',
             leftBtn: '取消',
             rightBtn: '完成',
             selectAll: 'ALL'
         },
         max: 0,
         singleSelection: false,
         styles: {
             mask: 'rgba(0,0,0,0)',
             title: {
                 bg: '#a33fad',
                 color: '#ffffff',
                 size: 16,
                 h: 44
             },
             leftButton: {
                 w: 80,
                 h: 35,
                 marginT: 5,
                 marginL: 8,
                 bg: '#711173',
                 color: '#ffffff',
                 size: 14
             },
             rightButton: {
                 w: 80,
                 h: 35,
                 marginT: 5,
                 marginR: 8,
                 bg: '#711173',
                 color: '#ffffff',
                 size: 14
             },
             item: {
                 h: 35,
                 bg: '#711173',
                 bgActive: '#a33fad',
                 bgHighlight: '#a33fad',
                 color: '#ffffff',
                 active: '#711173',
                 highlight: '#711173',
                 size: 14,
                 lineColor: '#ffffff',
                 textAlign: 'center'
             },
             icon: {
                 w: 20,
                 h: 20,
                 marginT: 11,
                 marginH: 8,
                 bg: '#fff',
                 align: 'left'
             }
         },
         animation: true,
         items: [{
               text: '周日',
               status: 'normal'
           }, {
               text: '周一',
               status: 'normal'
           }, {
               text: '周二',
               status: 'normal'
           }, {
               text: '周三',
               status: 'normal'
           }, {
               text: '周四',
               status: 'normal'
           }, {
               text: '周五',
               status: 'normal'
           }, {
               text: '周六',
               status: 'normal'
           }]
        },function(ret, err) {
             if (ret) {
                //  alert(JSON.stringify(ret));
                 if(ret.eventType=="clickRight"){
                   aType = '';
                   aStr = '';
                   for(var j = 0; j < ret.items.length; j++){
                     aStr = aStr+ret.items[j].text+' ';
                     if(ret.items[j].text=='周一'){
                       aType=aType+'1,';
                     }
                     if(ret.items[j].text=='周二'){
                       aType=aType+'2,';
                     }
                     if(ret.items[j].text=='周三'){
                       aType=aType+'3,';
                     }
                     if(ret.items[j].text=='周四'){
                       aType=aType+'4,';
                     }
                     if(ret.items[j].text=='周五'){
                       aType=aType+'5,';
                     }
                     if(ret.items[j].text=='周六'){
                       aType=aType+'6,';
                     }
                     if(ret.items[j].text=='周日'){
                       aType=aType+'0,';
                     }
                   }
                  //  aType = ret.items[0].text;
                   var htmlStr = "重复："+aStr;
                   var el = document.getElementById('alerttype');
                   $api.html(el, htmlStr);
                  //  alert(aType);
                  closetypeSelector();
                 }

             } else {
                //  alert(JSON.stringify(err));
             }
      });
    }

    function closetypeSelector () {
        var UIMultiSelector = api.require('UIMultiSelector');
        UIMultiSelector.close();
    }

    function openSound () {
      api.openFrame({
          name: 'sounds',
          url: './sound_frm.html',
          rect: {
              x: 0,
              y: api.winHeight/2-100,
              w: 'auto',
              h: 'auto'
              // w: api.winWidth,
              // h: api.winHeight
          },
          pageParam: {
              name: 'sounds'
          }
      });
    }

    function openTimeFrame () {


        api.openPicker({
            type: 'time',
            date: '12:30',
            title: '选择时间'
        }, function(ret, err) {
            if (ret) {
              var htmlStr = "提醒时间："+ret.hour+":"+ret.minute;
              var el = document.getElementById('alerttime');
              stime = ret.hour+":"+ret.minute;
              // alert( htmlStr );
              $api.html(el, htmlStr);
                // alert(JSON.stringify(ret));
            } else {
                // alert(JSON.stringify(err));
            }
        });
    }

    function alertsend () {

      api.showProgress({
          title: '数据处理中...',
          text: '请稍等...',
          modal: false
      });

      var uid = $api.getStorage("userid");
      var audiotitle = $api.val($api.byId("audiotitle"));

      // alert(audiotitle);

      api.ajax({
        url: 'http://47.105.67.225/public/index/useraudio/publish',
        method: 'post',
        dataType:'json',
        //cache: false,
        data: {
          values: {
            userid: uid,
            audiotitle: audiotitle,
            textinfo: '',
            useraudio: '',
            audiotype: sType,
            alerttime: stime,
            alerttype: aType,
            ringtype: rType
          },
          files: {
            file: 'fs://alertsound/'+timestamp+'.mp3'
          }
        }
      }, function(ret, err) {
           if (ret) {
             //api.alert({ msg: JSON.stringify(ret) });
             if(ret.status=="ok"){
               api.alert({
                  msg: ret.msg ,
              }, function(ret, err) {
                api.hideProgress();
                api.closeWin();
              });
             }else{
               api.alert({ msg: ret.msg });
             }

           }
        }
      );
    }


</script>
</html>
